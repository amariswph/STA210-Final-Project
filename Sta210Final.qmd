---
title: "STA210 SP'24 Final Project"
subtitle: "Exploring 2023 Stop and Frisk Data in NYC"
author: "amaris"
format: pdf
---

```{r, packages&dataset, message = F, warning =F, echo = F}
library(tidyverse) 
library(tidymodels)
library(dplyr)
library(readxl)
devtools::install_github('Mikata-Project/ggthemr')
library(ggthemr)
ggthemr('fresh')
stop_and_frisk <- read_excel("2023_nypd_stop_and_frisk_data.xlsx")
```

## Introduction:

### Background:

The stop-and-frisk program in New York City, administered by the NYPD, allows officers to detain, question, and potentially search individuals suspected of carrying weapons or contraband. This initiative has sparked significant controversy due to concerns of racial profiling. In 2017, 90% of those stopped were African-American or Latino, primarily aged between 14 and 24. Despite efforts to address racial disparities, such as policy reforms, the disproportionate impact of the stop-and-frisk program persists, highlighting potential underlying factors like implicit bias.

Implicit bias, also known as implicit prejudice or implicit attitude, is a negative attitude, of which one is not consciously aware, against a specific social group. It is thought to be shaped by experience and based on learned associations between particular qualities and social categories, including race and/gender/age etc. Individuals' perceptions and behaviors can be influenced by the implicit biases they hold, even if they are unaware they hold such biases.

### Dataset:

Each stop made by the NYPD requires officers to complete a detailed form, documenting various aspects of the encounter. Since 2017, these forms have been electronically recorded and stored in an NYPD database. The dataset contains information such as the stop's location, officer details, characteristics of the stopped individual (including age, race, gender, etc.), frisk/search details, and the officer's description of the individual's demeanor during the stop.

Our analysis will utilize the most recently released NYPD annual report from the source: https://www.nyc.gov/site/nypd/stats/reports-analysis/stopfrisk.page, containing 82 variables and 16,871 observations.

### Project Motivation & Research Question:

Among the 82 variables, a variable of particular interest is "demeanor of person stopped" - where the police utilize 1 - 2 adjectives to describe stop subject "demeanor". Common adjectives include "calm", "nervous", "agitated", "aggressive", etc. It should be noted that these descriptions are self-generated instead of the police choosing from a pre-defined set of adjectives. We propose that these "demeanor" adjectives are indicative of the police officers' perception of the stopped subject.

This project aims to investigate the relationship between physical/demographical characteristics of stopped individuals and the demeanor adjectives assigned by police officers. Specifically, we will explore:

-   How do officer-assigned demeanor adjectives vary across different demographic groups (age, race, gender)?
-   Are there correlations between certain physical characteristics and the types of demeanor descriptions used by officers during stops?
-   Additionally, we will briefly examine whether demeanor descriptions influence subsequent police behaviors, such as frisking, searching, or requesting consent.

By analyzing these relationships, we seek to shed light on potential implicit biases affecting police interactions during stop-and-frisk encounters. Understanding these dynamics is crucial for addressing systemic biases and ensuring fair and equitable policing practices.

### Variables Introduction:

**Predictor variables of interest:**

SUSPECT_REPORTED_AGE (chr and transformed to num): the age of suspect

SUSPECT_SEX (chr): female or male

SUSPECT_RACE_DESCRIPTION (chr): includes 7 categories: American Indian/Alaskan Native, Asian/Pacific Islander, Black, Black Hispanic, Middle Eastern/Southwest Asian, White, White Hispanic

SUSPECT_HEIGHT (chr and transformed to num): the height of suspect by feet

SUSPECT_WEIGHT (chr and transformed to num): the weight of suspect by pounds

SUSPECT_BODY_BUILD_TYPE (chr): includes categories: HEA(Heavy), MED(Medium), THN(Thin), U(Unknown), XXX(body type not applicable/placeholder value indicating missing data)

SUSPECT_EYE_COLOR (chr): includes categories: BLK(Black), BLU(Blue), BRO(Brown), GRN(Green), GRY(Grey), HAZ(Hazel), MUL(Multicolored), OTH(Other), PNK(Pink)

SUSPECT_HAIR_COLOR (chr): includes categories: BLD (Bald), BLK (Black), BLN (Blonde), BRO (Brown), GRN(Green), GRY (Gray), ORG (Orange), PLE (Purple), PNK(Pink), RED(Red), SDY(Sandy), WHI (White), XXX (Unknown/Unspecified - often used when the suspect's hair color is not recorded or unclear), ZZZ (could be an unusual or placeholder value indicating an error or missing data).

Note: The interpretation of categorical variables is based on conventions and assumptions due to the absence of a specific codebook for the dataset. Numeric variables (age, height, weight) are obtained through suspect report, while other categorical variables may reflect subjective perceptions of police or suspect report.

**Variables of interest for exploratory analysis:**

FRISKED_FLAG (chr): indicates whether or not the suspect was frisked (N = No, Y = Yes)

SEARCH_FLAG (chr): indicates whether or not the suspect was searched (N = No, Y = Yes)

ASK_FOR_CONSENT_FLG (chr): indicates whether the police asked for subject consent for the frisk/search behaviors after stop (N = No, Y = Yes)

### Data Cleaning & New Variable Creation

Upon reviewing the dataset, we identified a total of 1589 unique demeanor descriptions. To streamline our analysis, we focused on demeanor descriptions that appeared 10 or more times, aiming to capture meaningful trends and patterns. We then categorized these 69 demeanor descriptions into 5 broader categories based on their semantic similarities. While we recognize that the categorizations can be rather arbitrary, the groupings based on similarities in emotional or behavioral context allows for a more concise representation suitable for further analysis.

**1. Calm/Neutral Demeanor:** This category includes descriptions indicating a relaxed, cooperative, or normal state of mind.

\- CALM - NORMAL - APPARENTLY NORMAL - RELAXED - QUIET - UNDERSTANDING - CALM AND COOPERATIVE - CALM AND COMPLIANT - CALM AND UNDERSTANDING - CALM COOPERATIVE - CALMED - NEUTRAL - CALM COMPLIANT - CALM UNDERSTANDING - APP NORMAL - COMPLIANT - APPARENT NORMAL

**2. Nervous/Anxious Demeanor:** Descriptions reflecting anxiety, nervousness, or apprehension.

\- NERVOUS - ANXIOUS - VERY NERVOUS - EXTREMELY NERVOUS - PHYSICALLY NERVOUS - NERVOUS SCARED - NERVOUS OUT OF BREATH - AGGITATED - SCARED - SUSPICIOUS - APPREHENSIVE - WORRIED - NERVOUSE

**3. Angry/Confrontational Demeanor:** This category comprises descriptions indicating anger, aggression, or hostility.

\- UPSET - ANNOYED - ANGRY - AGITATED - AGGRESSIVE - COMBATIVE - IRATE - IRRITATED - AGGRAVATED - HOSTILE - MAD - AGGRESSIVE/NERVOUS - UNCOOPERATIVE - IRRATE - AGGRESIVE - ARGUMENTATIVE - DEFENSIVE - NON COMPLIANT

**4. Confused/Disoriented Demeanor:** Descriptions suggesting confusion, surprise, or disorientation.

\- CONFUSED - SURPRISED - SHOCKED - INTOXICATED - INTOX - ERRATIC - OUT OF BREATH

**5. Indifferent Demeanor:** Descriptions suggesting withdrawal

\- INDIFFERENT - EVASIVE - TIRED

Note: The following descriptions do not fit well into the above categories: Defensive (21), Laughing (16), Crying (14), Excited (14), Talkative (22) Given that the low relative frequencies (indicated in the brackets), we decided to remove them along with NAs (NA, N/A).

```{r, datacleaning_and_newvariable, message = F, warning = F}

stop_and_frisk_cleaned <- stop_and_frisk|>
   mutate(demeanor_category = case_when( #categorizing demeanor
    DEMEANOR_OF_PERSON_STOPPED %in% c(
      "CALM", "NORMAL", "APPARENTLY NORMAL", "RELAXED", "QUIET","UNDERSTANDING", 
      "CALM AND COOPERATIVE", "CALM AND COMPLIANT", "CALM AND UNDERSTANDING", 
      "CALM COOPERATIVE", "CALMED", "NEUTRAL", "CALM COMPLIANT", "CALM UNDERSTANDING", 
      "APP NORMAL", "COMPLIANT", "APPARENT NORMAL"
      ) ~ "Calm/Neutral Demeanor",
    DEMEANOR_OF_PERSON_STOPPED %in% c(
      "NERVOUS", "ANXIOUS", "VERY NERVOUS", "EXTREMELY NERVOUS","PHYSICALLY NERVOUS", 
      "NERVOUS SCARED", "NERVOUS OUT OF BREATH", "AGGITATED", "SCARED", "SUSPICIOUS", 
      "APPREHENSIVE", "WORRIED", "NERVOUSE"
      ) ~ "Nervous/Anxious Demeanor",
    DEMEANOR_OF_PERSON_STOPPED %in% c(
      "UPSET", "ANNOYED", "ANGRY", "AGITATED", "AGGRESSIVE", "COMBATIVE", "IRATE", 
      "IRRITATED", "AGGRAVATED", "HOSTILE", "MAD", "AGGRESSIVE/NERVOUS", "UNCOOPERATIVE", 
      "IRRATE", "AGGRESSIVE", "ARGUMENTATIVE", "DEFENSIVE", "NON COMPLIANT"
      ) ~ "Angry/Confrontational Demeanor",
    DEMEANOR_OF_PERSON_STOPPED %in% c(
      "CONFUSED", "SURPRISED", "SHOCKED", "INTOXICATED", "INTOX", "ERRATIC", "OUT OF BREATH"
      ) ~ "Confused/Disoriented Demeanor",
    DEMEANOR_OF_PERSON_STOPPED %in% c(
      "INDIFFERENT", "EVASIVE", "TIRED"
      ) ~ "Indifferent Demeanor",
    TRUE ~ "Other/NA"  # Default case for any other demeanor not matching the above
  )) |> 
  select(#Selecting relevant variables
    demeanor_category, SUSPECT_REPORTED_AGE, SUSPECT_SEX, SUSPECT_RACE_DESCRIPTION,
    SUSPECT_HEIGHT,SUSPECT_WEIGHT, SUSPECT_BODY_BUILD_TYPE, SUSPECT_EYE_COLOR,
    SUSPECT_HAIR_COLOR,FRISKED_FLAG, SEARCHED_FLAG, ASK_FOR_CONSENT_FLG
    ) |> 
  filter(demeanor_category != "Other/NA")  
```

```{r, visualizing_missingness, message = F, warning = F}
#Visualizing Missingness in Cleaned Dataset 
stop_and_frisk_cleaned <- stop_and_frisk_cleaned %>%
  mutate_all(~ na_if(., "(null)"))
library(naniar)
vis_miss(stop_and_frisk_cleaned)
# Among our variables of interest, no variable contains a significant amount of missing values that would require specialized handling. Therefore, for subsequent exploratory analysis, we will use listwise deletion to remove observations with missing values (NA).
```

### Exploratory Data Analysis

Variable Selection

```{r, categorical, message = F, warning = F}
stop_and_frisk_cleaned |>
  filter(!is.na(SUSPECT_RACE_DESCRIPTION)) |>
           ggplot(aes(x = SUSPECT_RACE_DESCRIPTION, fill = demeanor_category)) +
           geom_bar(position = "fill") +
  labs(x = "Race Description", y = "Proportion", title = "Relationship between Race and Demeanor Category") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  

stop_and_frisk_cleaned |>
  filter(!is.na(SUSPECT_SEX)) |>
  ggplot(aes(x = SUSPECT_SEX, fill = demeanor_category)) +
  geom_bar(position = "fill") +
  labs(x = "Sex", y = "Proportion", title = "Relationship between Sex and Demeanor Category") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  

stop_and_frisk_cleaned |>
  filter(!is.na(SUSPECT_BODY_BUILD_TYPE)) |>
  ggplot(aes(x = SUSPECT_BODY_BUILD_TYPE, fill = demeanor_category)) +
  geom_bar(position = "fill") +
  labs(x = "Body Type", y = "Proportion", title = "Relationship between Body Type and Demeanor Category") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  

stop_and_frisk_cleaned |>
  filter(!is.na(SUSPECT_EYE_COLOR)) |>
  ggplot(aes(x = SUSPECT_EYE_COLOR, fill = demeanor_category)) +
  geom_bar(position = "fill") +
  labs(x = "Eye Color", y = "Proportion", title = "Relationship between Eye Color and Demeanor Category") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  

stop_and_frisk_cleaned |>
  filter(!is.na(SUSPECT_HAIR_COLOR)) |>
  ggplot(aes(x = SUSPECT_HAIR_COLOR, fill = demeanor_category)) +
  geom_bar(position = "fill") +
  labs(x = "Hair Color", y = "Proportion", title = "Relationship between Hair Color and Demeanor Category") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  
```

```{r}
stop_and_frisk_cleaned <- stop_and_frisk_cleaned |> 
  mutate(SUSPECT_REPORTED_AGE = as.numeric(SUSPECT_REPORTED_AGE), 
         SUSPECT_HEIGHT = as.numeric(SUSPECT_HEIGHT), 
         SUSPECT_WEIGHT = as.numeric(SUSPECT_WEIGHT)
         )

ggplot(data = stop_and_frisk_cleaned, aes(x = demeanor_category, y = SUSPECT_REPORTED_AGE, fill = demeanor_category)) +
  geom_boxplot() +
  labs(x = "Demeanor Category", y = "Suspect Age", title = "Distribution of Suspect Age by Demeanor Category") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

ggplot(data = stop_and_frisk_cleaned, aes(x = demeanor_category, y = SUSPECT_WEIGHT, fill = demeanor_category)) +
  geom_boxplot() +
  labs(x = "Demeanor Category", y = "Suspect Age", title = "Distribution of Suspect Age by Demeanor Category") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

ggplot(data = stop_and_frisk_cleaned, aes(x = demeanor_category, y = SUSPECT_HEIGHT, fill = demeanor_category)) +
  geom_boxplot() +
  labs(x = "Demeanor Category", y = "Suspect Age", title = "Distribution of Suspect Age by Demeanor Category") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
#stop_and_frisk |> 
 # ggplot(aes(x = FRISKED_FLAG, fill = category)) + 
#  geom_bar(position = "fill")

#stop_and_frisk |> 
 # ggplot(aes(x = SEARCHED_FLAG, fill = category)) + 
 # geom_bar(position = "fill")

#stop_and_frisk |> 
 # ggplot(aes(x = ASK_FOR_CONSENT_FLG, fill = category)) + 
 # geom_bar(position = "fill")
```

## Methodology:

Multinomial Regression Model

Irrelevance of Independent Alternatives Assumption:

```{r}
library(nnet)
# Set calm/neutral as baseline
mtest <- multinom(demeanor_category ~ SUSPECT_REPORTED_AGE + SUSPECT_SEX + SUSPECT_RACE_DESCRIPTION + SUSPECT_EYE_COLOR + SUSPECT_HAIR_COLOR, data = stop_and_frisk_cleaned)
```

Assessing multicolinearity & interactions:

Linear relationship between continuous variables and the logit transformation of the outcome variable:

## Result

```{r}
#Model Display 
```

```{r}
#Statistical Significance
#  z <- summary(mtest)$coefficients/summary(mtest)$standard.errors
  # 2-tailed Wald z tests to test significance of coefficients
 # p <- (1 - pnorm(abs(z), 0, 1)) * 2
```

```{r}

```

**Key Interpretations:**

The model fit is clearly assessed, and interesting findings from the model are clearly described. Interpretations of model coefficients are used to support the key findings and conclusions, rather than merely listing the interpretation of every model coefficient. If the primary modeling objective is prediction, the model\'s predictive power is thoroughly assessed.

## Discussion

Overall conclusions from analysis are clearly described, and the model results are put into the larger context of the subject matter and original research question. There is thoughtful consideration of potential limitations of the data and/or analysis, and ideas for future work are clearly described.

Pattern

Evaluate Model - testing + training

limitations:

-missingness

-definition of categories

\-"reported age", weight - rather arbitrary when considering what's a "physical characteristic"

promportions + numbers
